{{/* layouts/shortcodes/dialog.html */}}

{{- $icon           := .Get "icon" | default "ðŸ’¬" -}}
{{- $title          := .Get "title" | default "" -}}
{{- $primaryLabel   := .Get "primary_label" | default "" -}}
{{- $primaryHref    := .Get "primary_href" | default "#" -}}
{{- $secondaryLabel := .Get "secondary_label" -}}
{{- $secondaryHref  := .Get "secondary_href" | default "#" -}}
{{- $variant        := (.Get "variant" | default "material" | lower) -}}

{{- $buttonsParam := .Get "buttons" -}}
{{- $buttons := slice -}}

{{- if $buttonsParam -}}
  {{/* buttons='[{"label":"..","href":"..","action":"link"}]' */}}
  {{- $buttons = $buttonsParam | transform.Unmarshal -}}
{{- else -}}
  {{/* Compatibilidad: primary / secondary clÃ¡sicos */}}
  {{- if $primaryLabel -}}
    {{- $buttons = $buttons | append (dict
      "label" $primaryLabel
      "href"  $primaryHref
      "kind"  "primary"
      "action" "link"
    ) -}}
  {{- end -}}

  {{- if $secondaryLabel -}}
    {{- $buttons = $buttons | append (dict
      "label" $secondaryLabel
      "href"  $secondaryHref
      "kind"  "secondary"
      "action" "link"
    ) -}}
  {{- end -}}
{{- end -}}

<div class="dialog-box dialog-variant-{{ $variant }}">
  <div class="dialog-header">
    <span class="dialog-icon">{{ $icon }}</span>
    {{- if $title -}}
      <h3 class="dialog-title">{{ $title }}</h3>
    {{- end -}}
  </div>

  <div class="dialog-body">
    {{- .Inner | markdownify -}}
  </div>

  {{- if gt (len $buttons) 0 -}}
    <div class="dialog-footer">
      {{- range $i, $btn := $buttons -}}
        {{- $label := index $btn "label" -}}
        {{- if not $label -}}
          {{- /* sin label, no se muestra */ -}}
        {{- else -}}
          {{- $action := (index $btn "action" | default "link" | lower) -}}
          {{- $kind   := (index $btn "kind"   | default "secondary" | lower) -}}
          {{- $btnIcon := index $btn "icon" -}}

          {{- if eq $action "link" -}}
            {{- $href := (index $btn "href" | default "#") -}}
            <a href="{{ $href }}" class="dialog-button dialog-button--{{ $kind }}">
              {{- with $btnIcon }}<span class="dialog-button-icon">{{ . }}</span>{{ end -}}
              <span class="dialog-button-label">{{ $label }}</span>
            </a>

          {{- else if eq $action "scroll" -}}
            {{- $target := (index $btn "target" | default "#") -}}
            <button
              class="dialog-button dialog-button--{{ $kind }}"
              onclick="document.querySelector('{{ $target }}')?.scrollIntoView({behavior:'smooth'})"
            >
              {{- with $btnIcon }}<span class="dialog-button-icon">{{ . }}</span>{{ end -}}
              <span class="dialog-button-label">{{ $label }}</span>
            </button>

          {{- else if eq $action "copy" -}}
            {{- $text := (index $btn "text" | default "" ) -}}
            <button
              class="dialog-button dialog-button--{{ $kind }}"
              onclick="navigator.clipboard.writeText('{{ $text }}')"
            >
              {{- with $btnIcon }}<span class="dialog-button-icon">{{ . }}</span>{{ end -}}
              <span class="dialog-button-label">{{ $label }}</span>
            </button>

          {{- else if eq $action "custom" -}}
            {{- $handler := (index $btn "handler" | default "" ) -}}
            <button
              class="dialog-button dialog-button--{{ $kind }}"
              onclick="{{ $handler }}()"
            >
              {{- with $btnIcon }}<span class="dialog-button-icon">{{ . }}</span>{{ end -}}
              <span class="dialog-button-label">{{ $label }}</span>
            </button>

          {{- end -}}
        {{- end -}}
      {{- end -}}
    </div>
  {{- end -}}
</div>
